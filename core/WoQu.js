// Generated by CoffeeScript 1.4.0
(function() {
  var Task, WoQu, db;

  db = require('./Db.js');

  Task = require('./model/Task.js');

  WoQu = {
    Task: null,
    args: null,
    run: function() {
      var task;
      WoQu.args = WoQu.getArgs();
      if (WoQu.args.length === 2 && WoQu.args[0] === 'add') {
        task = new Task();
        task.setDescription(WoQu.args[1]);
        task.setCreatedAt(new Date());
        task.setPostponed(0);
        return WoQu.addTask(task);
      } else if (WoQu.args.length === 1 && WoQu.args[0] === 'todo') {
        return WoQu.getTodo();
      } else if (WoQu.args.length === 1 && WoQu.args[0] === 'done') {
        return WoQu.setCurrentDone();
      } else if (WoQu.args.length === 1 && WoQu.args[0] === 'next') {
        return WoQu.nextFirst();
      }
      return console.error("Invalid command");
    },
    getArgs: function() {
      return process.argv.slice(2);
    },
    getDb: function() {
      return db;
    },
    nextFirst: function() {
      return WoQu.getDb().init(function(db) {
        return db.getCurrentTask(function(task) {
          task.increasePostponed();
          return db.updateTask(task, WoQu.getTodo);
        });
      });
    },
    setCurrentDone: function() {
      return WoQu.getDb().init(function(db) {
        return db.getCurrentTask(function(task) {
          task.setDoneAt(new Date());
          return db.updateTask(task, function() {
            return console.log(task.toString());
          });
        });
      });
    },
    getTodo: function() {
      return WoQu.getDb().init(function(db) {
        return db.getCurrentTask(function(task) {
          return console.log(task.toString());
        });
      });
    },
    addTask: function(task) {
      return WoQu.getDb().init(function(db) {
        return db.insertTask(task, function() {
          task.setId(this.lastID);
          return console.log("Task #" + (task.getId()) + " added");
        });
      });
    }
  };

  module.exports = WoQu;

}).call(this);
